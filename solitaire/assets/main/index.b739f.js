window.__require=function t(e,o,i){function n(a,c){if(!o[a]){if(!e[a]){var d=a.split("/");if(d=d[d.length-1],!e[d]){var s="function"==typeof __require&&__require;if(!c&&s)return s(d,!0);if(r)return r(d,!0);throw new Error("Cannot find module '"+a+"'")}a=d}var l=o[a]={exports:{}};e[a][0].call(l.exports,function(t){return n(e[a][1][t]||t)},l,l.exports,t,e,o,i)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<i.length;a++)n(i[a]);return n}({CardPile:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","CardPile");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0}),o.CARD_SELECT_POLICY=o.CARD_DRAG_POLICY=o.CARD_DISPLAY_POLICY=o.SORT_POLICY=void 0;var a,c,d,s,l=cc._decorator,h=l.ccclass,p=l.property,u=t("./Card");(function(t){t[t.BY_VALUE=0]="BY_VALUE",t[t.BY_REVERSE_VALUE=1]="BY_REVERSE_VALUE",t[t.BY_GROUP=2]="BY_GROUP",t[t.NO_SORT=3]="NO_SORT"})(a=o.SORT_POLICY||(o.SORT_POLICY={})),function(t){t[t.SHOW_ALL_CARDS=0]="SHOW_ALL_CARDS",t[t.SHOW_NO_CARDS=1]="SHOW_NO_CARDS",t[t.SHOW_ONLY_TOP_CARD=2]="SHOW_ONLY_TOP_CARD",t[t.SHOW_MULTI_TOP_CARDS=3]="SHOW_MULTI_TOP_CARDS"}(c=o.CARD_DISPLAY_POLICY||(o.CARD_DISPLAY_POLICY={})),function(t){t[t.ALL_CARDS=0]="ALL_CARDS",t[t.MULTI_TOP_CARDS=1]="MULTI_TOP_CARDS",t[t.SINGLE_TOP_CARD=2]="SINGLE_TOP_CARD",t[t.NO_CARDS=3]="NO_CARDS"}(d=o.CARD_DRAG_POLICY||(o.CARD_DRAG_POLICY={})),function(t){t[t.MULTI_CARDS=0]="MULTI_CARDS",t[t.SINGLE_CARD_ONLY=1]="SINGLE_CARD_ONLY",t[t.NO_CARDS=2]="NO_CARDS"}(s=o.CARD_SELECT_POLICY||(o.CARD_SELECT_POLICY={})),cc.Enum(a),cc.Enum(c),cc.Enum(d),cc.Enum(s);var C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.maxCards=-1,e.deckName="",e.interactable=!0,e.defaultMultiTopCards=1,e.sortPolicy=a.NO_SORT,e.displayPolicy=c.SHOW_ALL_CARDS,e.dragPolicy=d.NO_CARDS,e.selectPolicy=s.NO_CARDS,e.RAISE_AMOUNT=30,e.DURATION=.5,e._selected={},e._pickedCardStart={},e._inMotion={},e._dragStartLocation={},e._zindexStart={},e._insertionBasedMap={},e._tempDraggedNodes=[],e._displayedTopCards=1,e._selectedCards=[],e._draggingStartID=null,e._blockInteraction=!1,e._needDragEndReset=!0,e._stillInserting=!1,e}var o;return n(e,t),o=e,e.prototype.onLoad=function(){this.node.on("cardTouchStart",this.onCardTouchStart,this),this.node.on("cardTouchEnd",this.onCardTouchEnd,this),this.node.on("cardTouchMove",this.onCardTouchMove,this),this.node.on("cardTouchCancel",this.onCardTouchCancel,this),this.node.on("cardCollisionStart",this.onCardCollisionStart,this),this.node.on("cardCollisionStay",this.onCardCollisionStay,this),this.node.on("cardCollisionEnd",this.onCardCollisionEnd,this),this._displayedTopCards=this.defaultMultiTopCards,this.displayCards(),this.interactable&&(this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this))},e.prototype.update=function(){this._stillInserting||(this.displayCards(),this._resetPileCollisionBox())},e.prototype.onDestroy=function(){this.node.off("cardTouchStart",this.onCardTouchStart,this),this.node.off("cardTouchEnd",this.onCardTouchEnd,this),this.node.off("cardTouchMove",this.onCardTouchMove,this),this.node.off("cardTouchCancel",this.onCardTouchCancel,this),this.node.off("cardCollisionStart",this.onCardCollisionStart,this),this.node.off("cardCollisionStay",this.onCardCollisionStay,this),this.node.off("cardCollisionEnd",this.onCardCollisionEnd,this),this.interactable&&(this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this))},e.prototype.onTouchStart=function(t){t.stopPropagation(),this._launchEventToSuperiors("noCardPileTouchStart",t)},e.prototype.onTouchEnd=function(t){t.stopPropagation(),this._launchEventToSuperiors("noCardPileTouchEnd",t)},e.prototype.onTouchMove=function(t){t.stopPropagation(),this._launchEventToSuperiors("noCardPileTouchMove",t)},e.prototype.onTouchCancel=function(t){t.stopPropagation(),this._launchEventToSuperiors("noCardPileTouchCancel",t)},e.prototype.onCollisionEnter=function(t,e){e.node.getComponent("CardPile")._launchEventToSuperiors("card2pileCollisionStart",t.node.getComponent("Card").getCardProperties())},e.prototype.onCollisionStay=function(){},e.prototype.onCollisionExit=function(t,e){e.node.getComponent("CardPile")._launchEventToSuperiors("card2pileCollisionEnd",t.node.getComponent("Card").getCardProperties())},e.prototype._launchEventToSuperiors=function(t,e,o){var i,n;void 0===o&&(o=this.getCardPileProperties()),null===(i=cc.find("CardPileManager"))||void 0===i||i.emit(t,e,o),null===(n=cc.find("Canvas"))||void 0===n||n.emit(t,e,o),"Canvas"!=this.node.parent.name&&"CardPileManager"!=this.node.parent.name&&this.node.parent.emit(t,e,o)},e.prototype.getCardPileProperties=function(){return{node:this.getNode(),deckName:this.getDeckName(),selectedCards:this.getSelectedCards(),script:this.getScript()}},e.prototype.getNode=function(){return this.node},e.prototype.getDeckName=function(){return this.deckName},e.prototype.getSelectedCards=function(){return this._selectedCards},e.prototype.getScript=function(){return this},e.prototype.onCardTouchStart=function(t,e){e.node.getComponent("Card");var o=e.node,i=(e.group,e.value,e.name,e.id);if(!this._stillInserting&&!this._blockInteraction){switch(this._draggingStartID=i,this._tempDraggedNodes=[],this._selectedCards=[],this._dragStartLocation={},this._zindexStart={},this.dragPolicy){case d.NO_CARDS:break;case d.ALL_CARDS:this.selectPolicy=s.NO_CARDS,this._zindexStart[i]=o.parent.zIndex,this._dragStartLocation[i]=o.getPosition(),o.parent.zIndex=1,this._selectedCards.push(e);break;case d.SINGLE_TOP_CARD:this.selectPolicy=s.NO_CARDS,this.checkCardNodeIsTop(o)&&(this._zindexStart[i]=o.parent.zIndex,this._dragStartLocation[i]=o.getPosition(),o.parent.zIndex=1,this._selectedCards.push(e));break;case d.MULTI_TOP_CARDS:this.selectPolicy=s.NO_CARDS;var n=this.searchCardChildIndex(o);if(this.checkCardNodeIsTop(o,this._displayedTopCards)){for(var r=n;r<this.node.childrenCount;r++){var a=this.node.children[r],c=a.getComponent("Card");this._selectedCards.push(c),this._dragStartLocation[a.uuid]=a.getPosition()}this._zindexStart[i]=o.parent.zIndex,o.parent.zIndex=1}}this.checkCardNodeIsTop(o)&&this._launchEventToSuperiors("topCardPileTouchStart",t),this._launchEventToSuperiors("cardPileTouchStart",t)}},e.prototype.blockInteraction=function(t){this._blockInteraction=t},e.prototype.onCardTouchMove=function(t,e){e.node.getComponent("Card");var o=e.node,i=(e.group,e.value,e.name,e.id);if(!this._stillInserting&&!this._blockInteraction&&this._draggingStartID==i){switch(this.dragPolicy){case d.NO_CARDS:break;case d.ALL_CARDS:o.setPosition(o.getPosition().add(t.getDelta()));break;case d.SINGLE_TOP_CARD:this.checkCardNodeIsTop(o)&&o.setPosition(o.getPosition().add(t.getDelta()));break;case d.MULTI_TOP_CARDS:var n=this.searchCardChildIndex(o);if(this.checkCardNodeIsTop(o,this._displayedTopCards))for(var r=n;r<this.node.childrenCount;r++){var a=this.node.children[r];a.getComponent("Card"),a.setPosition(a.getPosition().add(t.getDelta()))}}this.selectPolicy,s.NO_CARDS,this.checkCardNodeIsTop(o)&&this._launchEventToSuperiors("topCardPileTouchMove",t),this._launchEventToSuperiors("cardPileTouchMove",t)}},e.prototype.onCardTouchEnd=function(t,e,o){var i=this;void 0===o&&(o=!1),e.node.getComponent("Card");var n=e.node,r=(e.group,e.value,e.name,e.id);if(!this._stillInserting&&!this._blockInteraction&&this._draggingStartID==r&&(this._draggingStartID=null,o||this.selectPolicy!=s.NO_CARDS&&(this._inMotion[r]||(this._inMotion[r]=!0,this._selected[r]?cc.tween(n).to(this.DURATION,{position:this._pickedCardStart[r]}).call(function(){i._inMotion[r]=!1}).start():(this._pickedCardStart[r]=n.getPosition(),cc.tween(n).to(this.DURATION,{position:this._pickedCardStart[r].add(cc.v3(0,this.RAISE_AMOUNT,0))}).call(function(){i._inMotion[r]=!1}).start()),this._selected[r]=!this._selected[r]),this.checkCardNodeIsTop(n)&&this._launchEventToSuperiors("topCardPileTouchEnd",t),this._launchEventToSuperiors("cardPileTouchEnd",t)),o?(this.checkCardNodeIsTop(n)&&this._launchEventToSuperiors("topCardPileTouchCancel",t),this._launchEventToSuperiors("cardPileTouchCancel",t)):(this.checkCardNodeIsTop(n)&&this._launchEventToSuperiors("topCardPileTouchEnd",t),this._launchEventToSuperiors("cardPileTouchEnd",t)),this.dragPolicy!=d.NO_CARDS&&(n.parent.zIndex=this._zindexStart[r]),this._needDragEndReset))switch(this.dragPolicy){case d.NO_CARDS:break;case d.ALL_CARDS:case d.SINGLE_TOP_CARD:this._dragStartLocation[r]&&n.setPosition(this._dragStartLocation[r]);break;case d.MULTI_TOP_CARDS:for(var a=this.searchCardChildIndex(n);a<this.node.childrenCount;a++){var c=this.node.children[a];this._dragStartLocation[c.uuid]&&c.setPosition(this._dragStartLocation[c.uuid])}}},e.prototype.setDragCardResetPosition=function(t){this._needDragEndReset=t},e.prototype.onCardTouchCancel=function(t,e){this.onCardTouchEnd(t,e,!0)},e.prototype.onCardCollisionStart=function(t,e){this._launchEventToSuperiors("card2cardCollisionStart",t,e)},e.prototype.onCardCollisionStay=function(){},e.prototype.onCardCollisionEnd=function(t,e){this._launchEventToSuperiors("card2cardCollisionEnd",t,e)},e.prototype._destroyFakeDraggingNodes=function(){for(var t=0,e=this._tempDraggedNodes;t<e.length;t++){var o=e[t];o.isValid&&o.destroy()}},e.prototype._moveFakeDraggingNodeByDelta=function(t){for(var e=0,o=this._tempDraggedNodes;e<o.length;e++){var i=o[e];i.setPosition(i.getPosition().add(t))}},e.prototype._addFakeDraggingNodeToCanvas=function(t,e){void 0===e&&(e=!0);var o=t.node,i=cc.instantiate(o),n=o.convertToWorldSpaceAR(cc.v2(0,0)),r=cc.find("Canvas").convertToNodeSpaceAR(n);return i.setScale(o.parent.getScale(cc.v3()).multiply(i.getScale(cc.v3()))),i.setPosition(r),i.getComponent(u.default).setManualCardPileNode(o.parent),cc.find("Canvas").addChild(i,cc.macro.MAX_ZINDEX),this._tempDraggedNodes.push(i),e&&this._selectedCards.push(t),i},e.prototype._addFakeTransitionNodeToCanvas=function(t){var e=t.node,o=cc.instantiate(e),i=e.convertToWorldSpaceAR(cc.v2(0,0)),n=cc.find("Canvas").convertToNodeSpaceAR(i);return o.setScale(e.parent.getScale(cc.v3()).multiply(o.getScale(cc.v3()))),o.setPosition(n),cc.find("Canvas").addChild(o,cc.macro.MAX_ZINDEX),o},e.prototype.searchCardChildIndex=function(t){for(var e=t,o=0;o<this.node.childrenCount;o++){var i=this.node.children[o];if(e.uuid==i.uuid)return o}return-1},e.prototype.checkCardNodeIsTop=function(t,e){return void 0===e&&(e=1),this.node.childrenCount-e<=this.searchCardChildIndex(t)},e.prototype.peekCardByIndex=function(t){if(t>=0&&t<this.node.childrenCount)return this.node.children[t]},e.prototype.peekTopCard=function(){return this.node.children[this.node.childrenCount-1]},e.prototype.peekBottomCard=function(){return this.node.children[0]},e.prototype.drawTopCards=function(t){void 0===t&&(t=1);for(var e=[],o=0;o<t;o++){var i=this.peekCardByIndex(this.node.childrenCount-o-1);e.push(i)}return this._drawCallbacks(),e},e.prototype.drawTopCard=function(){return this.drawTopCards()[0]},e.prototype.drawCardsByIndex=function(){for(var t=[],e=0;e<(void 0).length;e++){var o=this.peekCardByIndex((void 0)[e]);t.push(cc.instantiate(o)),o.destroy()}return this._drawCallbacks(),t},e.prototype.drawCardByIndex=function(t){var e=[t];return this.drawCardsByIndex(e)[0]},e.prototype._drawCallbacks=function(){},e.prototype._parallelTweens=function(t){for(var e=this,o=[],i=function(e){o.push(new Promise(function(o){t[e].call(function(){o(e)}).start()}))},n=0;n<t.length;n++)i(n);return Promise.all(o).then(function(){return new Promise(function(t){e._stillInserting=!1,e._cacheInsertingPileFromParent._stillInserting=!1,t(!0)})})},e.prototype._syncTweens=function(t){for(var e=this,o=new Promise(function(o){t[0].call(function(){0==t.length-1&&(e._stillInserting=!1,e._cacheInsertingPileFromParent._stillInserting=!1),o(0)}).start()}),i=function(i){o=o.then(function(){return new Promise(function(o){t[i].call(function(){i==t.length-1&&(e._stillInserting=!1,e._cacheInsertingPileFromParent._stillInserting=!1),o(i)}).start()})})},n=1;n<t.length;n++)i(n);return o},e.prototype.insertCardsToTop=function(t,e,i,n,r){var a=this;if(void 0===e&&(e=!0),void 0===i&&(i=.3),void 0===n&&(n=!0),void 0===r&&(r=function(){}),!this._stillInserting){var c,d,s=[],l=cc.v2(0,0);this.peekTopCard()?(d=this.peekTopCard().getPosition(),c=!1):(d=l,c=!0);for(var h=function(n){var h,u=p.node.getComponent(cc.Layout);if(u.resizeMode==cc.Layout.ResizeMode.NONE?(u.type==cc.Layout.Type.HORIZONTAL?(h=c?d:d.add(cc.v2(u.spacingX+n.width*n.scaleX,0)),d=h):u.type==cc.Layout.Type.VERTICAL?(h=c?d:d.add(cc.v2(0,u.spacingY+n.height*n.scaleY)),d=h):h=l,c=!1):h=l,e){p._stillInserting=!0,p._cacheInsertingPileFromParent=t[0].parent.getComponent(o),p._cacheInsertingPileFromParent._stillInserting=!0;var C=p._addFakeTransitionNodeToCanvas(n.getComponent("Card").getCardProperties()),f=C.getScale(cc.v2());C.zIndex=cc.macro.MAX_ZINDEX,C.setScale(p.node.parent.getScale(cc.v3()));var _=p.node.convertToWorldSpaceAR(C.position.add(cc.v3(h))),T=C.convertToNodeSpaceAR(_);C.setScale(f),n.getComponent("Card").makeCardInvisible(),C.getComponent(cc.BoxCollider).destroy(),s.push(cc.tween(C).call(function(){r()}).to(i,{position:cc.v3(T,0)}).call(function(){C.destroy(),n.getComponent("Card").makeCardVisible(),n.setPosition(h),n.setParent(a.node)}))}else n.getComponent("Card").makeCardVisible(),n.setPosition(h),n.setParent(p.node)},p=this,u=0,C=t;u<C.length;u++)h(C[u]);if(e)return n&&s.length>1?this._parallelTweens(s):this._syncTweens(s);this._insertCallback()}},e.prototype.insertCardToTop=function(t,e,o,i){return void 0===e&&(e=!0),void 0===o&&(o=.3),void 0===i&&(i=function(){}),this.insertCardsToTop([t],e,o,!1,i)},e.prototype._insertCallback=function(){},e.prototype.sortCards=function(){for(var t=[0],e=[],o=1;o<this.node.childrenCount;o++){for(var i=this.node.children[o].getComponent("Card"),n=-1,r=0;r<t.length;r++){var c=t[r],d=this.node.children[c].getComponent("Card");switch(this.sortPolicy){case a.BY_GROUP:d.getCardGroup()>i.getCardGroup()&&(n=r);break;case a.BY_VALUE:d.getCardValue()>i.getCardValue()&&(n=r);break;case a.BY_REVERSE_VALUE:d.getCardValue()<i.getCardValue()&&(n=r)}if(-1!=n)break}-1==n?t.push(o):t.splice(n,0,o)}for(var s=0;s<this.node.childrenCount;s++)e.push(cc.instantiate(this.node.children[t[s]]));for(s=0;s<this.node.childrenCount;s++)this.node.addChild(e[s]),this.node.removeChild(this.node.children[0])},e.prototype.shuffleCards=function(){for(var t=0;t<2*this.node.childrenCount;t++){var e=Math.floor(Math.random()*this.node.childrenCount),o=this.node.children[e];this.node.addChild(cc.instantiate(o)),this.node.removeChild(o)}},e.prototype._resetPileCollisionBox=function(){if(null!=this.node.getComponent(cc.BoxCollider)&&null==this._draggingStartID&&!this._stillInserting){var t,e,o=0,i=0;if(0==this.node.children.length)t=this.node.width,e=this.node.height,o=0,i=0;else{var n=this.node.children[0],r=this.node.children[this.node.childrenCount-1],a=cc.v2(n.x+n.anchorX*n.scaleX*n.width,n.y+n.anchorY*n.scaleY*n.height),c=cc.v2(r.x-r.anchorX*n.scaleX*r.width,r.y-r.anchorY*r.scaleY*r.height),d=a.sub(c);t=Math.abs(d.x),e=Math.abs(d.y),o=.5*Math.abs(n.x-r.x),i=.5*-Math.abs(n.y-r.y)}this.node.getComponent(cc.BoxCollider).size.height=e,this.node.getComponent(cc.BoxCollider).size.width=t,this.node.getComponent(cc.BoxCollider).offset.x=o,this.node.getComponent(cc.BoxCollider).offset.y=i}},e.prototype.displayCards=function(t){switch(void 0===t&&(t=!1),this.node.getComponent(cc.Layout).updateLayout(),this.displayPolicy){case c.SHOW_ALL_CARDS:for(var e=0,o=this.node.children;e<o.length;e++)(n=o[e]).getComponent("Card").showCard(t);break;case c.SHOW_NO_CARDS:for(var i=0;i<this.node.children.length;i++)(n=this.node.children[i].getComponent("Card")).hideCard(t);break;case c.SHOW_ONLY_TOP_CARD:for(i=0;i<this.node.children.length;i++){var n=this.node.children[i].getComponent("Card");i==this.node.childrenCount-1?n.showCard(t):n.hideCard(t)}break;case c.SHOW_MULTI_TOP_CARDS:for(i=0;i<this.node.children.length;i++)n=this.node.children[i].getComponent("Card"),i>=this.node.childrenCount-this._displayedTopCards?n.showCard(t):n.hideCard(t)}},e.prototype.setDefaultMultiTopCards=function(t){this.defaultMultiTopCards=t,this._displayedTopCards=this.defaultMultiTopCards},e.prototype.incrementDefaultMultiTopCards=function(t){void 0===t&&(t=1),this.defaultMultiTopCards+=t,this.defaultMultiTopCards=this.defaultMultiTopCards,this._displayedTopCards=this.defaultMultiTopCards},e.prototype.decrementDefaultMultiTopCards=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1),0==this.node.childrenCount&&(e=0),this.defaultMultiTopCards-=t,this.defaultMultiTopCards=Math.max(e,this.defaultMultiTopCards),this._displayedTopCards=this.defaultMultiTopCards},e.prototype.getDefaultMultiTopCards=function(){return this.defaultMultiTopCards},r([p({type:cc.Integer})],e.prototype,"maxCards",void 0),r([p],e.prototype,"deckName",void 0),r([p],e.prototype,"interactable",void 0),r([p({type:cc.Integer})],e.prototype,"defaultMultiTopCards",void 0),r([p({type:a})],e.prototype,"sortPolicy",void 0),r([p({type:c})],e.prototype,"displayPolicy",void 0),r([p({type:d})],e.prototype,"dragPolicy",void 0),r([p({type:s})],e.prototype,"selectPolicy",void 0),o=r([h],e)}(cc.Component);o.default=C,cc._RF.pop()},{"./Card":"Card"}],Card:[function(t,e,o){"use strict";cc._RF.push(e,"7acddAIn+1B0bXBFjMPKHDt","Card");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,d=a.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardGroup="",e.cardName="",e.cardValue=1,e.\u6b63\u9762=null,e.\u53cd\u9762=null,e.interactable=!0,e.cardFaceResource="",e.manualCardPileNode=null,e}return n(e,t),e.prototype.setManualCardPileNode=function(t){console.log("SET MANUAL NODE ",t),this.manualCardPileNode=t},e.prototype.onLoad=function(){this.node.zIndex=0,this.interactable&&(this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this)),this.loadCardFaceResource()},e.prototype.loadCardFaceResource=function(){},e.prototype.onDestroy=function(){this.interactable&&(this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this))},e.prototype.onTouchStart=function(t){t.stopPropagation(),this._launchEventToSuperiors("cardTouchStart",t)},e.prototype.onTouchEnd=function(t){t.stopPropagation(),this._launchEventToSuperiors("cardTouchEnd",t)},e.prototype.onTouchMove=function(t){t.stopPropagation(),this._launchEventToSuperiors("cardTouchMove",t)},e.prototype.onTouchCancel=function(t){t.stopPropagation(),this._launchEventToSuperiors("cardTouchCancel",t)},e.prototype._launchEventToSuperiors=function(t,e){var o,i,n=this.getCardProperties();null===(o=cc.find("CardManager"))||void 0===o||o.emit(t,e,n),null===(i=cc.find("Canvas"))||void 0===i||i.emit(t,e,n),"Canvas"!=this.node.parent.name&&"CardManager"!=this.node.parent.name&&this.node.parent.emit(t,e,n)},e.prototype.onCollisionEnter=function(t){var e;this._launchEventToSuperiors("cardCollisionStart",null===(e=t.node.getComponent("Card"))||void 0===e?void 0:e.getCardProperties())},e.prototype.onCollisionStay=function(t){var e;this._launchEventToSuperiors("cardCollisionStay",null===(e=t.node.getComponent("Card"))||void 0===e?void 0:e.getCardProperties())},e.prototype.onCollisionExit=function(t){var e;this._launchEventToSuperiors("cardCollisionEnd",null===(e=t.node.getComponent("Card"))||void 0===e?void 0:e.getCardProperties())},e.prototype.flipCard=function(t,e){switch(void 0===t&&(t="default"),void 0===e&&(e=1),t){case"rotate":var o;this.\u6b63\u9762.active?((o=this.node.getComponent(cc.Animation).play("CardFlipFront")).wrapMode=cc.WrapMode.Reverse,o.speed=e):((o=this.node.getComponent(cc.Animation).play("CardFlipFront")).wrapMode=cc.WrapMode.Normal,o.speed=e),this.\u6b63\u9762.active=!this.\u6b63\u9762.active,this.\u53cd\u9762.active=!this.\u53cd\u9762.active;break;case"default":default:this.\u6b63\u9762.active=!this.\u6b63\u9762.active,this.\u53cd\u9762.active=!this.\u53cd\u9762.active}},e.prototype.showCard=function(){this.\u6b63\u9762.active||(this.\u6b63\u9762.active=!0,this.\u53cd\u9762.active=!1)},e.prototype.hideCard=function(){this.\u53cd\u9762.active||(this.\u6b63\u9762.active=!1,this.\u53cd\u9762.active=!0)},e.prototype.makeCardInvisible=function(){this.node.opacity=0},e.prototype.makeCardVisible=function(){this.node.opacity=255},e.prototype.getCardProperties=function(){return{node:this.node,group:this.getCardGroup(),value:this.getCardValue(),name:this.getCardName(),id:this.node.uuid+"_"+this.getCardName()}},e.prototype.getCardGroup=function(){return this.cardGroup},e.prototype.getCardValue=function(){return this.cardValue},e.prototype.getCardName=function(){return this.cardName},e.prototype.compareValueAgainstOtherCard=function(t){return t.getComponent("Card").getCardValue()>=this.getCardValue()},r([d],e.prototype,"cardGroup",void 0),r([d],e.prototype,"cardName",void 0),r([d({type:cc.Integer})],e.prototype,"cardValue",void 0),r([d({type:cc.Node})],e.prototype,"\u6b63\u9762",void 0),r([d({type:cc.Node})],e.prototype,"\u53cd\u9762",void 0),r([d],e.prototype,"interactable",void 0),r([d],e.prototype,"cardFaceResource",void 0),r([c],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],SolitaireDemo:[function(t,e,o){"use strict";cc._RF.push(e,"35c05ZXLJ5LQ7VUbi2NRCqj","SolitaireDemo");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,a=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,o,i);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(a=(r<3?n(a):r>3?n(e,o,a):n(e,o))||a);return r>3&&a&&Object.defineProperty(e,o,a),a};Object.defineProperty(o,"__esModule",{value:!0});var a,c,d,s=t("../CardPile"),l=t("../Card"),h=cc._decorator,p=h.ccclass,u=h.property;(function(t){t[t.INIT=0]="INIT",t[t.PLAY=1]="PLAY",t[t.END=2]="END"})(a||(a={})),function(t){t[t.DIAMOND=0]="DIAMOND",t[t.CLUB=1]="CLUB",t[t.SPADE=2]="SPADE",t[t.HEART=3]="HEART"}(c||(c={})),function(t){t[t.RED=0]="RED",t[t.BLACK=1]="BLACK"}(d||(d={}));var C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.MainDeck=null,e.ReceiveDeck=null,e.cardPile1=null,e.cardPile2=null,e.cardPile3=null,e.cardPile4=null,e.cardPile5=null,e.cardPile6=null,e.cardPile7=null,e.suitePile1=null,e.suitePile2=null,e.suitePile3=null,e.suitePile4=null,e.\u8d62\u4e86=null,e.\u51fa\u724c\u58f0\u97f3=null,e.\u62ff\u724c\u97f3\u6548=null,e.\u6d17\u724c\u97f3\u6548=null,e.cardParticles=null,e._gameState=a.INIT,e._cacheSelectedCards=[],e._animSpeed=.3,e._showTips=!1,e.playCardAudio=function(){cc.audioEngine.playEffect(e.\u51fa\u724c\u58f0\u97f3,!1)},e._touchedPileMap={},e}return n(e,t),e.prototype.onLoad=function(){var t=cc.director.getCollisionManager();t.enabled=!0,t.enabledDebugDraw=!1,this.node.on("topCardPileTouchStart",this.onTopCardPileTouchStart,this),this.node.on("cardPileTouchStart",this.onCardPileTouchStart,this),this.node.on("cardPileTouchEnd",this.onCardPileTouchEnd,this),this.node.on("noCardPileTouchStart",this.onNoCardPileTouchStart,this),this.node.on("card2pileCollisionStart",this.onCard2PileCollisionStart,this),this.node.on("card2pileCollisionEnd",this.onCard2PileCollisionEnd,this)},e.prototype.onDestroy=function(){this.node.off("topCardPileTouchStart",this.onTopCardPileTouchStart,this),this.node.off("cardPileTouchStart",this.onCardPileTouchStart,this),this.node.off("cardPileTouchEnd",this.onCardPileTouchEnd,this),this.node.off("noCardPileTouchStart",this.onNoCardPileTouchStart,this),this.node.off("card2pileCollisionStart",this.onCard2PileCollisionStart,this),this.node.off("card2pileCollisionEnd",this.onCard2PileCollisionEnd,this)},e.prototype.restartGame=function(){cc.director.loadScene("SolitaireDemo",function(){})},e.prototype.onHandleToggle=function(t,e){var o=t.isChecked;switch(e){case"Music":var i=o?1:0;cc.audioEngine.setMusicVolume(i);break;case"Sound":i=o?1:0,cc.audioEngine.setEffectsVolume(i);break;case"Tips":this._showTips=o}},e.prototype.start=function(){var t,e=this;cc.audioEngine.setEffectsVolume(1),cc.audioEngine.setMusicVolume(.3),cc.audioEngine.playMusic(this.node.getComponent(cc.AudioSource).clip,!0),this._gameState=a.INIT,this.MainDeck.shuffleCards();var o=this._animSpeed;this.cardPile1.blockInteraction(!0),this.cardPile2.blockInteraction(!0),this.cardPile3.blockInteraction(!0),this.cardPile4.blockInteraction(!0),this.cardPile5.blockInteraction(!0),this.cardPile6.blockInteraction(!0),this.cardPile7.blockInteraction(!0),t=this.MainDeck.drawTopCards(1),this.cardPile1.insertCardsToTop(t,!0,o,!1,this.playCardAudio).then(function(){return t=e.MainDeck.drawTopCards(2),e.cardPile2.insertCardsToTop(t,!0,o,!1,e.playCardAudio)}).then(function(){return t=e.MainDeck.drawTopCards(3),e.cardPile3.insertCardsToTop(t,!0,o,!1,e.playCardAudio)}).then(function(){return t=e.MainDeck.drawTopCards(4),e.cardPile4.insertCardsToTop(t,!0,o,!1,e.playCardAudio)}).then(function(){return t=e.MainDeck.drawTopCards(5),e.cardPile5.insertCardsToTop(t,!0,o,!1,e.playCardAudio)}).then(function(){return t=e.MainDeck.drawTopCards(6),e.cardPile6.insertCardsToTop(t,!0,o,!1,e.playCardAudio)}).then(function(){return t=e.MainDeck.drawTopCards(7),e.cardPile7.insertCardsToTop(t,!0,o,!1,e.playCardAudio)}).then(function(){e._gameState=a.PLAY,e.cardPile1.setDefaultMultiTopCards(1),e.cardPile1.blockInteraction(!1),e.cardPile2.setDefaultMultiTopCards(1),e.cardPile2.blockInteraction(!1),e.cardPile3.setDefaultMultiTopCards(1),e.cardPile3.blockInteraction(!1),e.cardPile4.setDefaultMultiTopCards(1),e.cardPile4.blockInteraction(!1),e.cardPile5.setDefaultMultiTopCards(1),e.cardPile5.blockInteraction(!1),e.cardPile6.setDefaultMultiTopCards(1),e.cardPile6.blockInteraction(!1),e.cardPile7.setDefaultMultiTopCards(1),e.cardPile7.blockInteraction(!1)})},e.prototype._beforeTouchCallback=function(){return this._gameState==a.PLAY},e.prototype.onTopCardPileTouchStart=function(t,e){e.node.getComponent("CardPile"),e.node;var o=e.deckName;if(e.selectedCards,this._beforeTouchCallback()&&o==this.MainDeck.deckName){var i=this.MainDeck.drawTopCard();this.ReceiveDeck.insertCardToTop(i,!0,this._animSpeed,this.playCardAudio)}},e.prototype.onCardPileTouchStart=function(t,e){e.node.getComponent("CardPile"),e.node;var o=e.deckName,i=e.selectedCards;this._beforeTouchCallback()&&o!=this.MainDeck.deckName&&(cc.audioEngine.playEffect(this.\u62ff\u724c\u97f3\u6548,!1),this._highlightOnly(i.map(function(t){return t.node})))},e.prototype.onCardPileTouchEnd=function(t,e){var o=e.node.getComponent("CardPile"),i=e.node,n=(e.deckName,e.selectedCards);if(this._beforeTouchCallback()){var r,a=!1;for(var c in this._touchedPileMap)if(this._touchedPileMap[c]&&c!=i.name){r=cc.find("Canvas").getChildByName(c),o.setDragCardResetPosition(!1),this._selectedCardsHighlight(n),a=this._checkCanPutSelectedCard(r);break}if(!a&&0!=n.length){var d=n[0].node.getParent().getComponent(s.default).deckName;"CardPile"==d?a=this._checkCanPutSelectedCard(e.node):"SuitePile"==d&&(a=this._checkCanPutSelectedCard(e.node))}a||(o.setDragCardResetPosition(!0),this._selectedCardsHighlight(n)),this._touchedPileMap={}}},e.prototype._selectedCardsHighlight=function(t){this._selectedCardsRelease(),this._cacheSelectedCards=t,this._highlightOnly(t.map(function(t){return t.node}))},e.prototype._highlightOnly=function(t){var e=this;t.forEach(function(t){t.getChildByName("\u6b63\u9762").color=cc.color(255,133,0,255),t.getChildByName("\u6b63\u9762").addChild(cc.instantiate(e.cardParticles))})},e.prototype._releaseOnly=function(t){t.forEach(function(t){t.getChildByName("\u6b63\u9762").color=cc.color(255,255,255,255);var e=cc.instantiate(t.getChildByName("\u6b63\u9762").children[0]);t.getChildByName("\u6b63\u9762").removeAllChildren(),t.getChildByName("\u6b63\u9762").addChild(e)})},e.prototype._releaseAllHighlights=function(){this._releaseOnly(this.cardPile1.drawTopCards(this.cardPile1.getDefaultMultiTopCards())),this._releaseOnly(this.cardPile2.drawTopCards(this.cardPile2.getDefaultMultiTopCards())),this._releaseOnly(this.cardPile3.drawTopCards(this.cardPile3.getDefaultMultiTopCards())),this._releaseOnly(this.cardPile4.drawTopCards(this.cardPile4.getDefaultMultiTopCards())),this._releaseOnly(this.cardPile5.drawTopCards(this.cardPile5.getDefaultMultiTopCards())),this._releaseOnly(this.cardPile6.drawTopCards(this.cardPile6.getDefaultMultiTopCards())),this._releaseOnly(this.cardPile7.drawTopCards(this.cardPile7.getDefaultMultiTopCards()))},e.prototype._selectedCardsRelease=function(){this._releaseOnly(this._cacheSelectedCards.map(function(t){return t.node})),this._cacheSelectedCards=[]},e.prototype.onNoCardPileTouchStart=function(t,e){this._beforeTouchCallback()&&(e.deckName==this.MainDeck.deckName?this._resetMainDeck():e.deckName==this.ReceiveDeck.deckName||this._checkCanPutSelectedCard(e.node))},e.prototype._resetMainDeck=function(){var t=this._animSpeed;cc.audioEngine.playEffect(this.\u6d17\u724c\u97f3\u6548,!1);var e=this.ReceiveDeck.drawTopCards(this.ReceiveDeck.node.childrenCount);this.MainDeck.insertCardsToTop(e,!0,t,!0)},e.prototype._checkCanPutSelectedCard=function(t){var e=this;if(0!=this._cacheSelectedCards.length&&this._cacheSelectedCards[0].node.getParent()!=t){var o=t.getComponent(s.default),i=o.peekTopCard(),n=o.deckName,r=this._cacheSelectedCards[0].node,a=r.getParent();switch(n){case"CardPile":return i?i.getComponent(l.default).cardValue!=1+r.getComponent(l.default).cardValue||this._checkColorsSame(i,r)?(console.log("CARDPILE - CASE 2: \u653e\u5361\u7247\u6709\u5361\u724c\uff0c\u53ea\u80fd\u653e\u6bd4\u5f53\u4e0b\u5927\u7684\u5361\u724c+\u4e0d\u4e00\u6837\u989c\u8272\u7684\u724c"),this._showTips&&alert("CARDPILE - CASE 2: \u653e\u5361\u7247\u6709\u5361\u724c\uff0c\u53ea\u80fd\u653e\u6bd4\u5f53\u4e0b\u5927\u7684\u5361\u724c+\u4e0d\u4e00\u6837\u989c\u8272\u7684\u724c"),!1):(t.getComponent(s.default).insertCardsToTop(this._cacheSelectedCards.map(function(t){return t.node}),!0,this._animSpeed,!0,this.playCardAudio).then(function(){e._afterInsertionCallbacks(t,a)}),!0):13==r.getComponent(l.default).cardValue?(t.getComponent(s.default).insertCardsToTop(this._cacheSelectedCards.map(function(t){return t.node}),!0,this._animSpeed,!0,this.playCardAudio).then(function(){e._afterInsertionCallbacks(t,a)}),!0):(console.log("CARDPILE - CASE 1: \u653e\u5361\u7247\u6ca1\u6709\u5361\u724c\uff0c\u90a3\u53ea\u80fd\u653eK"),this._showTips&&alert("CARDPILE - CASE 1: \u653e\u5361\u7247\u6ca1\u6709\u5361\u724c\uff0c\u90a3\u53ea\u80fd\u653eK"),!1);case"SuitePile":return i?i.getComponent(l.default).cardValue+1==r.getComponent(l.default).cardValue&&this._getCardSuite(i)==this._getCardSuite(r)?(t.getComponent(s.default).insertCardsToTop(this._cacheSelectedCards.map(function(t){return t.node}),!0,this._animSpeed,!0,this.playCardAudio).then(function(){e._afterInsertionCallbacks(t,a)}),!0):(console.log("SUITEPILE - CASE 2: \u653e\u5361\u7247\u6709\u5361\u724c\uff0c\u53ea\u80fd\u653e\u6bd4\u5f53\u4e0b\u5927\u7684\u5361\u724c+\u4e0d\u4e00\u6837\u989c\u8272\u7684\u724c"),this._showTips&&alert("SUITEPILE - CASE 2: \u653e\u5361\u7247\u6709\u5361\u724c\uff0c\u53ea\u80fd\u653e\u6bd4\u5f53\u4e0b\u5927\u7684\u5361\u724c+\u4e0d\u4e00\u6837\u989c\u8272\u7684\u724c"),!1):1==r.getComponent(l.default).cardValue?(t.getComponent(s.default).insertCardsToTop(this._cacheSelectedCards.map(function(t){return t.node}),!0,this._animSpeed,!0,this.playCardAudio).then(function(){e._afterInsertionCallbacks(t,a)}),!0):(console.log("SUITEPILE - CASE 1: \u653e\u5361\u7247\u6ca1\u6709\u5361\u724c\uff0c\u90a3\u53ea\u80fd\u653eA"),this._showTips&&alert("SUITEPILE - CASE 1: \u653e\u5361\u7247\u6ca1\u6709\u5361\u724c\uff0c\u90a3\u53ea\u80fd\u653eA"),!1)}}},e.prototype._checkColorsSame=function(t,e){var o=this._getCardSuite(t),i=this._getCardSuite(e);return o==c.SPADE||o==c.CLUB?i==c.SPADE||i==c.CLUB:o==c.DIAMOND||o==c.HEART?i==c.DIAMOND||i==c.HEART:void 0},e.prototype._getCardSuite=function(t){switch(t.getComponent(l.default).getCardGroup().toLowerCase()){case"spade":return c.SPADE;case"diamond":return c.DIAMOND;case"club":return c.CLUB;case"heart":return c.HEART}},e.prototype._afterInsertionCallbacks=function(t,e){t.getComponent(s.default).incrementDefaultMultiTopCards(this._cacheSelectedCards.length),e.getComponent(s.default).decrementDefaultMultiTopCards(this._cacheSelectedCards.length,1),this._checkVictory(),this._releaseAllHighlights()},e.prototype._checkPileIsComplete=function(t){if(13!=t.childrenCount)return!1;for(var e=1,o=0,i=t.children;o<i.length;o++){if(e!=i[o].getComponent(l.default).getCardValue())return!1;e++}return!0},e.prototype._checkVictory=function(){var t=this._checkPileIsComplete(this.suitePile1.node),e=this._checkPileIsComplete(this.suitePile2.node),o=this._checkPileIsComplete(this.suitePile3.node),i=this._checkPileIsComplete(this.suitePile4.node);t&&e&&o&&i&&(this._gameState,a.END,this._playEndScene())},e.prototype._playEndScene=function(){this.\u8d62\u4e86.active=!0,this.\u8d62\u4e86.zIndex=cc.macro.MAX_ZINDEX,this.cardPile1.blockInteraction(!0),this.cardPile2.blockInteraction(!0),this.cardPile3.blockInteraction(!0),this.cardPile4.blockInteraction(!0),this.cardPile5.blockInteraction(!0),this.cardPile6.blockInteraction(!0),this.cardPile7.blockInteraction(!0),this.suitePile1.blockInteraction(!0),this.suitePile2.blockInteraction(!0),this.suitePile3.blockInteraction(!0),this.suitePile4.blockInteraction(!0)},e.prototype.onCard2PileCollisionStart=function(t,e){this._beforeTouchCallback()&&(this._touchedPileMap={},this._touchedPileMap[e.node.name]=!0)},e.prototype.onCard2PileCollisionEnd=function(t,e){this._beforeTouchCallback()&&(this._touchedPileMap[e.node.name]=!1)},r([u({type:s.default})],e.prototype,"MainDeck",void 0),r([u({type:s.default})],e.prototype,"ReceiveDeck",void 0),r([u({type:s.default})],e.prototype,"cardPile1",void 0),r([u({type:s.default})],e.prototype,"cardPile2",void 0),r([u({type:s.default})],e.prototype,"cardPile3",void 0),r([u({type:s.default})],e.prototype,"cardPile4",void 0),r([u({type:s.default})],e.prototype,"cardPile5",void 0),r([u({type:s.default})],e.prototype,"cardPile6",void 0),r([u({type:s.default})],e.prototype,"cardPile7",void 0),r([u({type:s.default})],e.prototype,"suitePile1",void 0),r([u({type:s.default})],e.prototype,"suitePile2",void 0),r([u({type:s.default})],e.prototype,"suitePile3",void 0),r([u({type:s.default})],e.prototype,"suitePile4",void 0),r([u({type:cc.Node})],e.prototype,"\u8d62\u4e86",void 0),r([u({type:cc.AudioClip})],e.prototype,"\u51fa\u724c\u58f0\u97f3",void 0),r([u({type:cc.AudioClip})],e.prototype,"\u62ff\u724c\u97f3\u6548",void 0),r([u({type:cc.AudioClip})],e.prototype,"\u6d17\u724c\u97f3\u6548",void 0),r([u({type:cc.Prefab})],e.prototype,"cardParticles",void 0),r([p],e)}(cc.Component);o.default=C,cc._RF.pop()},{"../Card":"Card","../CardPile":"CardPile"}]},{},["Card","CardPile","SolitaireDemo"]);